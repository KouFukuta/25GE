<!-- app/templates/form.html -->

<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>app</title>

  <!-- fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=M+PLUS+1p&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
    rel="stylesheet">

  <!-- normalizecss -->
  <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css" />
  <!-- tailwindcss -->
  <!-- <script src="https://cdn.tailwindcss.com"></script> -->
  <!-- css -->
  <link rel="stylesheet" href="../static/style.css">


</head>

<body>
  <div class="header">
    <img class="logo" src="/static/images/IMG_1320.PNG" alt="">
    <h1 class="m-plus custom-h1">test.</h1>
  </div>

    <img class="character" id="aiCharacter" src="/static/images/IMG_1317.PNG" alt="">

  <div class="container">

    <div class="question-form">
      <h2 class="m-plus custom-h2">Question.</h2>
      <p class="m-plus">{{ question }}</p>

      <form method="post">
        <input type="hidden" name="question" value="{{ question }}">
        <h2 class="m-plus custom-h2">Answer.</h2>

        <div class="form-container">
          <textarea name="answer" placeholder="あなたの回答を入力してください"
            class="m-plus form-textarea">{{ answer or "" }}</textarea>
          <button type="submit" class="m-plus form-submit">Submit</button>
        </div>
      </form>
    </div>



    <div id="chat-log">
      <h2 class="m-plus custom-h2">ChatLog</h2>
      {% for log in chatLogs %}
      <div class="log-list">
        {% if log.question %}
        <div class="m-plus AI-response">Question: {{ log.question }}</div>
        {% endif %}
        <div class="m-plus user-input">User: {{ log.answer }}</div>
        <div class="m-plus AI-response typewriter" data-text="{{ log.response }}">{{ log.response }}</div>

      </div>
      {% endfor %}
    </div>

  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const chatContainer = document.getElementById("chat-log");
      if (chatContainer) {
        // スクロールを一番下にする
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }
    });

    function typeWriterEffect(el, text, delay = 30) {
      el.textContent = "";
      let i = 0;

      const interval = setInterval(() => {
        el.textContent += text[i];
        i++;
        if (i >= text.length) {
          clearInterval(interval);
          stopTalking();
        }
      }, delay);
    }

    function startTalking() {
      const char = document.getElementById("aiCharacter");
      if (char) char.classList.add("talking");
    }

    function stopTalking() {
      const char = document.getElementById("aiCharacter");
      if (char) char.classList.remove("talking");
    }

    document.addEventListener("DOMContentLoaded", () => {
      const responses = document.querySelectorAll(".typewriter");
      if (responses.length > 0) {
        const last = responses[responses.length - 1];
        const text = last.dataset.text;
        startTalking();
        typeWriterEffect(last, text);
      }

      const chatContainer = document.getElementById("chat-log");
      if (chatContainer) {
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }
    });


  </script>

</body>

</html>